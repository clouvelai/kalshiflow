[build]
builder = "nixpacks"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3
startCommand = "cd backend && PYTHONPATH=/app/backend/src python -m uvicorn kalshiflow.app:app --host 0.0.0.0 --port $PORT --ws-ping-interval 30 --ws-ping-timeout 10 --timeout-keep-alive 300"

# Railway-specific WebSocket optimizations
[variables]
# Increase connection timeout for WebSocket stability
STARLETTE_WS_TIMEOUT = "300"
UVICORN_TIMEOUT_KEEP_ALIVE = "300"
UVICORN_WS_PING_INTERVAL = "30"
UVICORN_WS_PING_TIMEOUT = "10"