{
  "project": "Kalshi Flowboard",
  "deployment_strategy": "Railway + Supabase",
  "created_at": "2025-12-05",
  "last_updated": "2025-12-05T20:00:00Z",
  "overview": {
    "hosting_platform": "Railway",
    "database": "Supabase PostgreSQL",
    "architecture": "Full-stack deployment with native WebSocket support",
    "estimated_cost": "$5-20/month",
    "deployment_time": "30-60 minutes total setup"
  },
  "why_railway": {
    "websocket_support": "Native WebSocket support with zero configuration",
    "python_starlette_support": "Excellent Python/Starlette/ASGI support",
    "simplified_deployment": "Single command deployment with railway up",
    "git_integration": "Automatic Git-based deployments",
    "environment_management": "Superior environment variable management",
    "cost_effective": "More affordable than other platforms",
    "developer_experience": "Streamlined CLI and dashboard experience",
    "supabase_compatibility": "Proven compatibility with Supabase PostgreSQL"
  },
  "prerequisites": {
    "tools_required": [
      "Railway CLI installed (npm install -g @railway/cli)",
      "Git repository with latest changes",
      "Supabase project configured and running",
      "Backend E2E tests passing",
      "Frontend E2E tests passing"
    ],
    "accounts_needed": [
      "Railway account (railway.app)",
      "GitHub account (for repository access)",
      "Supabase account (existing project)"
    ],
    "environment_validation": [
      "uv run pytest tests/test_backend_e2e_regression.py -v (must pass)",
      "npm run test:frontend-regression (must pass)",
      "Local development working with Supabase"
    ]
  },
  "deployment_phases": {
    "phase_1": {
      "name": "Railway Project Setup",
      "duration": "15 minutes",
      "tasks": [
        {
          "step": 1,
          "name": "Install Railway CLI",
          "command": "npm install -g @railway/cli",
          "description": "Install the Railway command line interface",
          "validation": "railway --version"
        },
        {
          "step": 2,
          "name": "Login to Railway",
          "command": "railway login",
          "description": "Authenticate with Railway using GitHub",
          "validation": "railway whoami"
        },
        {
          "step": 3,
          "name": "Create Railway Project",
          "command": "railway new",
          "description": "Create new Railway project for Kalshi Flowboard",
          "options": {
            "project_name": "kalshi-flowboard",
            "starter_template": "Empty Project"
          }
        },
        {
          "step": 4,
          "name": "Link Repository",
          "command": "railway link",
          "description": "Connect local repository to Railway project",
          "validation": "railway status"
        }
      ]
    },
    "phase_2": {
      "name": "Environment Configuration", 
      "duration": "10 minutes",
      "tasks": [
        {
          "step": 1,
          "name": "Set Database Variables",
          "commands": [
            "railway variables set DATABASE_URL=<supabase_connection_string>",
            "railway variables set DATABASE_URL_POOLED=<supabase_pooled_connection_string>"
          ],
          "description": "Configure Supabase PostgreSQL connection strings",
          "critical": true
        },
        {
          "step": 2,
          "name": "Set Kalshi API Variables",
          "commands": [
            "railway variables set KALSHI_API_KEY=<your_api_key>",
            "railway variables set KALSHI_PRIVATE_KEY_PATH=<path_to_rsa_key>",
            "railway variables set KALSHI_WS_URL=wss://api.elections.kalshi.com/trade-api/ws/v2"
          ],
          "description": "Configure Kalshi API authentication",
          "critical": true
        },
        {
          "step": 3,
          "name": "Set Application Variables",
          "commands": [
            "railway variables set WINDOW_MINUTES=10",
            "railway variables set HOT_MARKETS_LIMIT=20",
            "railway variables set RECENT_TRADES_LIMIT=200",
            "railway variables set WARM_RESTART_ENABLED=true",
            "railway variables set METADATA_FETCH_ENABLED=true"
          ],
          "description": "Configure application-specific settings"
        },
        {
          "step": 4,
          "name": "Verify Variables",
          "command": "railway variables",
          "description": "List all configured environment variables",
          "validation": "Ensure all critical variables are set"
        }
      ]
    },
    "phase_3": {
      "name": "Backend Service Deployment",
      "duration": "15 minutes",
      "tasks": [
        {
          "step": 1,
          "name": "Create Procfile",
          "file_path": "./Procfile",
          "content": "web: cd backend && uv run uvicorn kalshiflow.app:app --host 0.0.0.0 --port $PORT",
          "description": "Define how Railway starts the backend service"
        },
        {
          "step": 2,
          "name": "Create Railway Config",
          "file_path": "./railway.toml",
          "content": "[build]\nbuilder = \"nixpacks\"\nbuildCommand = \"cd backend && pip install uv && uv sync\"\n\n[deploy]\nstartCommand = \"cd backend && uv run uvicorn kalshiflow.app:app --host 0.0.0.0 --port $PORT\"\nhealthcheckPath = \"/health\"\nhealthcheckTimeout = 300\nrestartPolicyType = \"on_failure\"",
          "description": "Configure Railway build and deployment settings"
        },
        {
          "step": 3,
          "name": "Deploy Backend",
          "command": "railway up",
          "description": "Deploy backend service to Railway",
          "expected_duration": "5-10 minutes",
          "validation": "Check deployment logs and health endpoint"
        },
        {
          "step": 4,
          "name": "Verify Backend Health",
          "validation_steps": [
            "railway logs --tail 50",
            "curl -f $RAILWAY_PUBLIC_DOMAIN/health",
            "Check WebSocket endpoint accessibility"
          ]
        }
      ]
    },
    "phase_4": {
      "name": "Production Validation",
      "duration": "20 minutes", 
      "tasks": [
        {
          "step": 1,
          "name": "Run Backend E2E Tests",
          "command": "cd backend && uv run pytest tests/test_backend_e2e_regression.py -v",
          "description": "Validate backend functionality against production",
          "critical": true,
          "success_criteria": "All tests must pass"
        },
        {
          "step": 2,
          "name": "Test WebSocket Connections",
          "description": "Verify WebSocket connections work in production",
          "validation_steps": [
            "Test WebSocket endpoint directly",
            "Verify real-time data flow",
            "Check connection stability"
          ]
        },
        {
          "step": 3,
          "name": "Frontend Production Testing",
          "description": "Update frontend to use production backend and test",
          "tasks": [
            "Update frontend API endpoints to Railway URL",
            "Deploy frontend (if separate service needed)",
            "Run frontend E2E tests against production backend"
          ]
        },
        {
          "step": 4,
          "name": "Performance Validation",
          "metrics_to_check": [
            "Response time < 200ms",
            "WebSocket connection latency < 100ms", 
            "Database query performance acceptable",
            "Memory usage within Railway limits"
          ]
        }
      ]
    }
  },
  "configuration_templates": {
    "railway_toml": {
      "file_path": "./railway.toml",
      "content": "[build]\nbuilder = \"nixpacks\"\nbuildCommand = \"cd backend && pip install uv && uv sync\"\n\n[deploy]\nstartCommand = \"cd backend && uv run uvicorn kalshiflow.app:app --host 0.0.0.0 --port $PORT\"\nhealthcheckPath = \"/health\"\nhealthcheckTimeout = 300\nrestartPolicyType = \"on_failure\"\nwatchPaths = [\"backend/src/**/*.py\"]\n\n[environments]\n[environments.production]\nRAILWAY_ENVIRONMENT_NAME = \"production\""
    },
    "procfile": {
      "file_path": "./Procfile", 
      "content": "web: cd backend && uv run uvicorn kalshiflow.app:app --host 0.0.0.0 --port $PORT"
    },
    "nixpacks_config": {
      "file_path": "./nixpacks.toml",
      "content": "[phases.install]\ncmds = [\n  \"cd backend\",\n  \"pip install uv\",\n  \"uv sync\"\n]\n\n[phases.build]\ncmds = [\"echo 'Build phase complete'\"]\n\n[start]\ncmd = \"cd backend && uv run uvicorn kalshiflow.app:app --host 0.0.0.0 --port $PORT\""
    }
  },
  "required_environment_variables": {
    "database": {
      "DATABASE_URL": {
        "description": "Supabase PostgreSQL direct connection string",
        "example": "postgresql://postgres:[PASSWORD]@db.[PROJECT_ID].supabase.co:5432/postgres",
        "critical": true
      },
      "DATABASE_URL_POOLED": {
        "description": "Supabase PostgreSQL pooled connection string",
        "example": "postgresql://postgres:[PASSWORD]@db.[PROJECT_ID].supabase.co:6543/postgres", 
        "critical": true
      }
    },
    "kalshi_api": {
      "KALSHI_API_KEY": {
        "description": "Kalshi API key ID",
        "critical": true
      },
      "KALSHI_PRIVATE_KEY_PATH": {
        "description": "Path to RSA private key file",
        "example": "/app/kalshi_private_key.pem",
        "critical": true
      },
      "KALSHI_WS_URL": {
        "description": "Kalshi WebSocket endpoint",
        "default": "wss://api.elections.kalshi.com/trade-api/ws/v2",
        "critical": true
      }
    },
    "application": {
      "WINDOW_MINUTES": {
        "description": "Time window for aggregating trades",
        "default": "10"
      },
      "HOT_MARKETS_LIMIT": {
        "description": "Maximum number of hot markets to display",
        "default": "20"
      },
      "RECENT_TRADES_LIMIT": {
        "description": "Maximum number of recent trades to keep",
        "default": "200"
      },
      "WARM_RESTART_ENABLED": {
        "description": "Enable warm restart functionality",
        "default": "true"
      },
      "METADATA_FETCH_ENABLED": {
        "description": "Enable metadata fetching",
        "default": "true"
      }
    }
  },
  "deployment_commands": {
    "initial_deployment": [
      "# 1. Project Setup",
      "railway login",
      "railway new",
      "railway link",
      "",
      "# 2. Environment Configuration",
      "railway variables set DATABASE_URL=<supabase_url>",
      "railway variables set DATABASE_URL_POOLED=<supabase_pooled_url>",
      "railway variables set KALSHI_API_KEY=<api_key>",
      "railway variables set KALSHI_PRIVATE_KEY_PATH=<private_key_path>",
      "railway variables set KALSHI_WS_URL=wss://api.elections.kalshi.com/trade-api/ws/v2",
      "",
      "# 3. Deploy",
      "railway up",
      "",
      "# 4. Monitor",
      "railway logs"
    ],
    "subsequent_deployments": [
      "# Quick redeploy after code changes",
      "git add .",
      "git commit -m \"Update: describe changes\"",
      "railway up"
    ],
    "rollback": [
      "# Rollback to previous deployment", 
      "railway rollback",
      "railway logs"
    ]
  },
  "monitoring_and_troubleshooting": {
    "health_checks": {
      "backend_health": {
        "endpoint": "/health",
        "expected_response": "HTTP 200 with JSON status",
        "description": "Basic application health check"
      },
      "websocket_health": {
        "endpoint": "/ws",
        "test": "WebSocket connection should upgrade successfully",
        "description": "WebSocket connectivity check"
      }
    },
    "logging": {
      "view_logs": "railway logs",
      "tail_logs": "railway logs --tail 50",
      "filter_logs": "railway logs | grep ERROR"
    },
    "common_issues": {
      "deployment_fails": {
        "symptoms": "Railway deployment fails during build",
        "causes": ["Dependency conflicts", "Build timeout", "Memory limits"],
        "solutions": ["Check railway logs", "Verify uv dependencies", "Optimize build process"]
      },
      "database_connection_fails": {
        "symptoms": "Backend fails to connect to Supabase",
        "causes": ["Incorrect DATABASE_URL", "Network connectivity", "Connection pool exhausted"],
        "solutions": ["Verify environment variables", "Check Supabase status", "Review connection pooling"]
      },
      "websocket_issues": {
        "symptoms": "WebSocket connections fail or drop",
        "causes": ["Network timeouts", "Railway proxy issues", "Application logic errors"],
        "solutions": ["Check Railway networking", "Verify WebSocket endpoint", "Review application logs"]
      }
    },
    "performance_monitoring": {
      "metrics_to_track": [
        "Response time",
        "Memory usage",
        "Database connection count",
        "WebSocket connection stability",
        "Error rates"
      ],
      "railway_dashboard": "Access metrics via Railway project dashboard",
      "custom_monitoring": "Consider adding application-level metrics"
    }
  },
  "cost_optimization": {
    "railway_pricing": {
      "starter_plan": "$5/month - Suitable for development and light production",
      "pro_plan": "$20/month - For higher traffic production use",
      "usage_based": "Additional costs for compute time beyond plan limits"
    },
    "cost_saving_tips": [
      "Use starter plan initially",
      "Monitor resource usage via dashboard",
      "Optimize application for efficiency",
      "Consider scaling strategies as traffic grows"
    ],
    "total_estimated_cost": {
      "railway": "$5-20/month",
      "supabase": "$0-25/month (free tier available)",
      "total": "$5-45/month (significantly lower than alternatives)"
    }
  },
  "security_considerations": {
    "environment_variables": [
      "All secrets managed through Railway dashboard",
      "Never commit API keys to repository",
      "Use Railway's secure variable system",
      "Regular rotation of API credentials"
    ],
    "database_security": [
      "Supabase connection strings secured in Railway",
      "Use Row Level Security in Supabase",
      "Monitor database access patterns",
      "Keep Supabase credentials confidential"
    ],
    "application_security": [
      "HTTPS enforced by Railway by default",
      "Secure WebSocket connections (WSS)",
      "Input validation on all endpoints",
      "Regular security updates"
    ]
  },
  "success_criteria": {
    "technical_requirements": [
      "✅ Backend deploys successfully to Railway",
      "✅ All environment variables configured correctly",
      "✅ WebSocket connections work reliably in production",
      "✅ Database connectivity to Supabase established",
      "✅ Health check endpoints responding correctly",
      "✅ Backend E2E tests pass against production",
      "✅ Performance meets baseline requirements"
    ],
    "operational_requirements": [
      "✅ Deployment completes in under 15 minutes",
      "✅ Monitoring and logging functional",
      "✅ Error handling works in production",
      "✅ Rollback procedure tested and documented",
      "✅ Cost optimization implemented"
    ],
    "business_requirements": [
      "✅ Application accessible to users 24/7",
      "✅ Real-time data flowing without interruption",
      "✅ Professional, reliable user experience",
      "✅ Scalable infrastructure for growth",
      "✅ Cost-effective production deployment"
    ]
  },
  "post_deployment": {
    "immediate_tasks": [
      "Verify all services are running",
      "Test end-to-end functionality",
      "Monitor performance for first 24 hours",
      "Document production URLs and access methods"
    ],
    "ongoing_maintenance": [
      "Monitor Railway dashboard regularly",
      "Review cost usage monthly", 
      "Update dependencies as needed",
      "Scale services based on traffic patterns",
      "Maintain security best practices"
    ],
    "scaling_considerations": [
      "Monitor resource usage trends",
      "Consider Railway Pro plan for higher traffic",
      "Optimize database queries as data grows",
      "Implement caching strategies if needed"
    ]
  },
  "support_resources": {
    "railway_documentation": "https://docs.railway.app/",
    "railway_community": "Railway Discord and GitHub discussions",
    "supabase_documentation": "https://supabase.com/docs",
    "project_specific": [
      "Backend E2E tests for validation",
      "Frontend E2E tests for integration testing",
      "CLAUDE.md for project-specific guidance"
    ]
  }
}